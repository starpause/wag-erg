<project default="Package for iOS - TEST" name="WAG ERG iOS" basedir="."> <!-- Edit me: Ant script name -->
	<description>
		Buildfile for iOS off template by Vaclav Vancura (http://vancura.org ~ Copyright 2011)
    </description>

	<!-- import project properties -->
	<property file="build-iOS.properties" />	
	
	<tstamp>
		<format property="timestamp" pattern="yyyy-MM-dd_HH-mm-ss" />
	</tstamp>
	
	<!-- FLEX SDK configuration -->
	<property name="mxmlc_path" value="${flex_sdk_dir}/lib/mxmlc.jar" />
	<property name="adt_path" value="${flex_sdk_dir}/lib/adt.jar" />
	
	<!-- Application configuration -->
	<property name="assets_dir" value="bin" />
	<property name="certificates_dir" value="config" />
	<property name="deploy_dir" value="deploy" />
	<property name="libs_dir" value="libs" />
	
	<!-- Desktop configuration -->
	<property name="desktop_certificate_filename" value="${certificates_dir}/${desktop_certificate_name}.pfx" />
	<property name="desktop_air_filename" value="${deploy_dir}/${app_name}_${timestamp}.air" />
	<property name="desktop_descriptor" value="${assets_dir}/desktop-app.xml" />
	
	<property name="ios_ipa_filename" value="${debug_dir}/${app_name}.ipa" />
	<!--
	<property name="ios_ipa_filename" value="${deploy_dir}/${app_name}_${timestamp}.ipa" />	
	-->

	<!-- Compile SWF to build directory for desktop packaging -->
	<target name="3. Compile">
		<java jar="${mxmlc_path}" fork="true" failonerror="true">
			<arg value="-debug=false" />
			<arg value="-optimize=true" />
			<arg value="+flexlib=${flex_sdk_dir}/frameworks" />
			<arg value="+configname=air" />
			<arg value="-file-specs=${main_source}" />
			<arg value="-output=${swf_filename}" />
			<arg value="-l+=${libs_dir}" />
		</java>
	</target>



	
	
	<!-- iOS configuration -->
	<property name="ios_target" value="ipa-test" />
	<!--
		Edit me: choose one from:
			* ipa-test - Quick publishing for device testing
			* ipa-debug - Quick publishing for device debugging
			* ipa-ad-hoc - Deployment - Ad hoc
			* ipa-app-store - Deployment - Apple App Store
		OR set these up as different targets
		AND have different mobile provisions as targets for all the ad-hocs
	-->	
	
	<target name="Package for iOS - TEST" depends="3. Compile">
		<java jar="${adt_path}" fork="true" failonerror="true">
			<arg line="-package" />
			<arg line="-target ipa-test" />
			<arg line="-storetype pkcs12" />
			<arg line="-keystore '${ios_certificate_filename}'" />
			<arg line="-storepass '${ios_certificate_password}'" />
			<arg line="-provisioning-profile '${ios_provisioning_profile_test}'" />
			<arg line="'${ios_ipa_filename}'" />
			<arg line="'${ios_iphone_descriptor}'" />
			
			<!-- Add folders to be bundled in the AIR file here -->
			<!--<arg line="${swf_filename}" />-->
			<arg line="${swf_filename}" />
			<arg line="${assets_dir}/icons" />
			<arg line="Default.png" />
		</java>
	</target>
	
	<target name="Package for iOS - AD HOC" depends="3. Compile">
		<java jar="${adt_path}" fork="true" failonerror="true">
			<arg line="-package" />
			<arg line="-target ipa-ad-hoc" />
			<arg line="-storetype pkcs12" />
			<arg line="-keystore '${ios_certificate_distribution}'" />
			<arg line="-storepass '${ios_certificate_distribution_password}'" />
			<arg line="-provisioning-profile '${ios_provisioning_profile_ad_hoc}'" />
			<arg line="'${ios_ipa_filename}'" />
			<arg line="'${ios_iphone_descriptor}'" />
			
			<!-- Add folders to be bundled in the AIR file here -->
			<!--<arg line="${swf_filename}" />-->
			<arg line="${swf_filename}" />
			<arg line="${assets_dir}/icons" />
			<arg line="Default.png" />
		</java>
	</target>
	
	<target name="Package for iOS - APP STORE" depends="3. Compile">
		<java jar="${adt_path}" fork="true" failonerror="true">
			<arg line="-package" />
			<arg line="-target ipa-app-store" />
			<arg line="-storetype pkcs12" />
			<arg line="-keystore '${ios_certificate_filename}'" />
			<arg line="-storepass '${ios_certificate_password}'" />
			<arg line="-provisioning-profile '${ios_provisioning_profile_app_store}'" />
			<arg line="'${ios_ipa_filename}'" />
			<arg line="'${ios_iphone_descriptor}'" />
			
			<!-- Add folders to be bundled in the AIR file here -->
			<!--<arg line="${swf_filename}" />-->
			<arg line="${swf_filename}" />
			<arg line="${assets_dir}/icons" />
			<arg line="Default.png" />
		</java>
	</target>
	
</project>
